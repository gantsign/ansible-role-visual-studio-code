---
- name: create config directories for users
  become: yes
  become_user: '{{ item.0.username }}'
  file:
    path: '~{{ item.0.username }}/.config'
    state: directory
    mode: 'u=rwx,go=r'
  with_subelements:
    - '{{ users }}'
    - visual_studio_code_extensions
    - skip_missing: yes

- name: create Visual Studio Code directories for users
  become: yes
  become_user: '{{ item.0.username }}'
  file:
    path: '~{{ item.0.username }}/.config/Code/User'
    state: directory
    mode: 'u=rwx,go='
  with_subelements:
    - '{{ users }}'
    - visual_studio_code_extensions
    - skip_missing: yes

- name: install extensions
  become: yes
  become_user: '{{ item.0.username }}'
  visual_studio_code_install_extension:
    name: '{{ item.1 }}'
  with_subelements:
    - '{{ users }}'
    - visual_studio_code_extensions
    - skip_missing: yes
